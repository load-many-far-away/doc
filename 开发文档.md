# 开发文档

机器人开发过程中，主要涉及到两种组件；

*	代理
*  后端程序


## 代理的作用

*	转发微信插件的请求转发至后端程序

	*	当前请求转发使用的是HTTP请求，后续需要切换为HTTPS请求;
	*  需要在代理中加入鉴权机制，作为安全防护；如ifwallet当前的那种`API key`的鉴权机制就可以;

*	将来自后端程序的应答转发给微信插件

## 后端程序

**目录结构**

*	app 目录：设计了程序的主体结构，以及handler来处理来自代理的请求;
* 	exchange目录：设计了与交易所沟通的接口，当前实现了`Coinex`, `Binance`的查询报价接口；后续，如果有需要，可以继续将该接口进行拓展；依据一定的规则，将请求分发至`Binance`或`Coinex`交易所;
	*  为后续的买币提供数据支持
*  wallets 目录：设计了与钱包沟通的接口，当前主要实现了`ifwallet`的钱包接口；后续，如果有需要，可以进行拓展其它钱包的接口；依据规则，将请求转发;
*  util 目录：实现了日志功能；
*  storage 目录：实现了存储功能，使用`Leveldb`作为数据库的存储。当前实现了如下功能
	*  记录用户的钱包ID、账户地址；
	*  以及存储用户的买币记录
*	settlement 目录：定义了用户的买币的算法；使用从`exchange`抓取的数据，计算相应的RMB可以购买的token数量。
	* 后续可以实现该接口，实现特定的算法；如：可以在此处设置滑点，收取用户的手续费。。。

**配置文件**	

*	wallet info：配置了与钱包链接有关的信息
*  coins：配置了币种的文件路径；允许文件中的币种进行价格查询(从`Coinmarketcap`上抓取的前300的币种)，减少必要的请求消耗。
*  https key: 配置了HTTPs请求相关的证书路径；在后续服务器程序切换至https时，需要配置该选项
*  advert file：配置了机器人的广告文本信息；在程序启动时，会将文本信息载入；文本中每行数据，表示一条广告；
	*  后续可以将该配置文件升级为热更新，以便可以随时替换、增加广告的内容
*	listen port：配置了程序的监听端口； `proxy`配置可以去掉了。
* user info: 刚开始设计的鉴权机制，只允许特定的用户访问该后端程序，现在可以去掉了；
	* 使用ifwallet模式的鉴权机制，可以使鉴权更为灵活
* leveldb path: 数据库存储数据的路径








	